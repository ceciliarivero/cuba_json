<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class MailFactory - mailfactory-1.4.0 Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/mailfactory.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-add_attachment">#add_attachment</a>
    
    <li><a href="#method-i-add_attachment_as">#add_attachment_as</a>
    
    <li><a href="#method-i-add_header">#add_header</a>
    
    <li><a href="#method-i-attach">#attach</a>
    
    <li><a href="#method-i-attach_as">#attach_as</a>
    
    <li><a href="#method-i-body_to_s">#body_to_s</a>
    
    <li><a href="#method-i-buildattachmentboundary">#buildattachmentboundary</a>
    
    <li><a href="#method-i-buildbodyboundary">#buildbodyboundary</a>
    
    <li><a href="#method-i-construct">#construct</a>
    
    <li><a href="#method-i-file_encode">#file_encode</a>
    
    <li><a href="#method-i-generate_boundary">#generate_boundary</a>
    
    <li><a href="#method-i-get_header">#get_header</a>
    
    <li><a href="#method-i-headers_to_s">#headers_to_s</a>
    
    <li><a href="#method-i-html-3D">#html=</a>
    
    <li><a href="#method-i-method_missing">#method_missing</a>
    
    <li><a href="#method-i-multipart-3F">#multipart?</a>
    
    <li><a href="#method-i-quote_address_if_necessary">#quote_address_if_necessary</a>
    
    <li><a href="#method-i-quote_if_necessary">#quote_if_necessary</a>
    
    <li><a href="#method-i-quoted_printable_encode">#quoted_printable_encode</a>
    
    <li><a href="#method-i-quoted_printable_encode_header">#quoted_printable_encode_header</a>
    
    <li><a href="#method-i-quoted_printable_with_instruction">#quoted_printable_with_instruction</a>
    
    <li><a href="#method-i-rawhtml-3D">#rawhtml=</a>
    
    <li><a href="#method-i-remove_header">#remove_header</a>
    
    <li><a href="#method-i-replyto">#replyto</a>
    
    <li><a href="#method-i-replyto-3D">#replyto=</a>
    
    <li><a href="#method-i-set_header">#set_header</a>
    
    <li><a href="#method-i-text-3D">#text=</a>
    
    <li><a href="#method-i-to_s">#to_s</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./MIME.html">MIME</a>
  
    <li><a href="./MIME/Types.html">MIME::Types</a>
  
    <li><a href="./MailFactory.html">MailFactory</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class MailFactory</h1>

  <div id="description" class="description">
    
<p>An easy class for creating a mail message</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="VERSION">VERSION
        
        <dd class="description">
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 53</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>()
  <span class="ruby-ivar">@headers</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-ivar">@attachments</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-ivar">@attachmentboundary</span> = <span class="ruby-identifier">generate_boundary</span>()
  <span class="ruby-ivar">@bodyboundary</span> = <span class="ruby-identifier">generate_boundary</span>()
  <span class="ruby-ivar">@html</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@text</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@charset</span> = <span class="ruby-string">'utf-8'</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-add_attachment" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_attachment</span><span
            class="method-args">(filename, type=nil, attachmentheaders = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>adds an attachment to the mail.  Type may be given as a mime type.  If it
is left off and the <a href="MIME/Types.html">MIME::Types</a> module is
available it will be determined automagically. If the optional
attachemntheaders is given, then they will be added to the attachment
boundary in the email, which can be used to produce Content-ID markers. 
attachmentheaders can be given as an Array or a String.</p>
          

          
          <div class="method-source-code" id="add_attachment-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 244</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_attachment</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">type</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">attachmentheaders</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">attachment</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'filename'</span>] = <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">basename</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'mimetype'</span>] = <span class="ruby-constant">MIME</span><span class="ruby-operator">::</span><span class="ruby-constant">Types</span>.<span class="ruby-identifier">type_for</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'mimetype'</span>] = <span class="ruby-identifier">type</span>
  <span class="ruby-keyword">end</span> 
  
  <span class="ruby-comment"># Open in rb mode to handle Windows, which mangles binary files opened in a text mode</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">&quot;rb&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'attachment'</span>] = <span class="ruby-identifier">file_encode</span>(<span class="ruby-identifier">fp</span>.<span class="ruby-identifier">read</span>())
  }

  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">attachmentheaders</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">attachmentheaders</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>))
      <span class="ruby-identifier">attachmentheaders</span> = <span class="ruby-identifier">attachmentheaders</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">%r\r?\n/</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'headers'</span>] = <span class="ruby-identifier">attachmentheaders</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@attachments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attachment</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_attachment-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MailFactory.html#method-i-attach">attach</a>
        </div>
        

        
      </div><!-- add_attachment-method -->

    
      <div id="method-i-add_attachment_as" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_attachment_as</span><span
            class="method-args">(file, emailfilename, type=nil, attachmentheaders = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>adds an attachment to the mail as emailfilename.  Type may be given as a
mime type.  If it is left off and the <a
href="MIME/Types.html">MIME::Types</a> module is available it will be
determined automagically. file may be given as an IO stream (which will be
read until the end) or as a filename. If the optional attachemntheaders is
given, then they will be added to the attachment boundary in the email,
which can be used to produce Content-ID markers.  attachmentheaders can be
given as an Array of a String.</p>
          

          
          <div class="method-source-code" id="add_attachment_as-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 275</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_attachment_as</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">emailfilename</span>, <span class="ruby-identifier">type</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">attachmentheaders</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">attachment</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'filename'</span>] = <span class="ruby-identifier">emailfilename</span>

  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">type</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'mimetype'</span>] = <span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>()
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Pathname</span>))
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'mimetype'</span>] = <span class="ruby-constant">MIME</span><span class="ruby-operator">::</span><span class="ruby-constant">Types</span>.<span class="ruby-identifier">type_for</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">to_s</span>()).<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'mimetype'</span>] = <span class="ruby-string">''</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword">or</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Pathname</span>))    
    <span class="ruby-comment"># Open in rb mode to handle Windows, which mangles binary files opened in a text mode</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">to_s</span>(), <span class="ruby-string">&quot;rb&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'attachment'</span>] = <span class="ruby-identifier">file_encode</span>(<span class="ruby-identifier">fp</span>.<span class="ruby-identifier">read</span>())
    }
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:read</span>))
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'attachment'</span>] = <span class="ruby-identifier">file_encode</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>())
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span>(<span class="ruby-constant">Exception</span>, <span class="ruby-string">&quot;file is not a supported type (must be a String, Pathnamem, or support read method)&quot;</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">attachmentheaders</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">attachmentheaders</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Array</span>))
      <span class="ruby-identifier">attachmentheaders</span> = <span class="ruby-identifier">attachmentheaders</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">%r\r?\n/</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">attachment</span>[<span class="ruby-string">'headers'</span>] = <span class="ruby-identifier">attachmentheaders</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-ivar">@attachments</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">attachment</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_attachment_as-source -->
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MailFactory.html#method-i-attach_as">attach_as</a>
        </div>
        

        
      </div><!-- add_attachment_as-method -->

    
      <div id="method-i-add_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_header</span><span
            class="method-args">(header, value)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>adds a header to the bottom of the headers</p>
          

          
          <div class="method-source-code" id="add_header-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 65</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">quoted_printable_with_instruction</span>(<span class="ruby-identifier">value</span>, <span class="ruby-ivar">@charset</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">header</span> <span class="ruby-operator">==</span> <span class="ruby-string">'subject'</span>
  <span class="ruby-identifier">value</span> = <span class="ruby-identifier">quote_address_if_necessary</span>(<span class="ruby-identifier">value</span>, <span class="ruby-ivar">@charset</span>) <span class="ruby-keyword">if</span> <span class="ruby-node">%w[from to cc bcc reply-to]</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">header</span>.<span class="ruby-identifier">downcase</span>)
  <span class="ruby-ivar">@headers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{header}: #{value}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- add_header-source -->
          
        </div>

        

        
      </div><!-- add_header-method -->

    
      <div id="method-i-attach" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">attach</span><span
            class="method-args">(filename, type=nil, attachmentheaders = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MailFactory.html#method-i-add_attachment">add_attachment</a>
        </div>
        
      </div><!-- attach-method -->

    
      <div id="method-i-attach_as" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">attach_as</span><span
            class="method-args">(file, emailfilename, type=nil, attachmentheaders = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MailFactory.html#method-i-add_attachment_as">add_attachment_as</a>
        </div>
        
      </div><!-- attach_as-method -->

    
      <div id="method-i-construct" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">construct</span><span
            class="method-args">(options = Hash.new)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>builds an email and returns it as a string.  Takes the following options:</p>
<dl class="rdoc-list note-list"><dt><code>:messageid</code>
<dd>
<p>Adds a message id to the message based on the from header (defaults to
false)</p>
</dd><dt><code>:date</code>
<dd>
<p>Adds a date to the message if one is not present (defaults to true)</p>
</dd></dl>
          

          
          <div class="method-source-code" id="construct-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 175</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">construct</span>(<span class="ruby-identifier">options</span> = <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>)
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:date</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:date</span>] = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:messageid</span>])
    <span class="ruby-comment"># add a unique message-id</span>
    <span class="ruby-identifier">remove_header</span>(<span class="ruby-string">&quot;Message-ID&quot;</span>)
    <span class="ruby-identifier">sendingdomain</span> = <span class="ruby-identifier">get_header</span>(<span class="ruby-string">'from'</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span>()[<span class="ruby-regexp">%r@([-a-zA-Z0-9._]+)/</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_s</span>()
    <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;Message-ID&quot;</span>, <span class="ruby-node">&quot;&lt;#{Time.now.to_f()}.#{Process.euid()}.#{String.new.object_id()}@#{sendingdomain}&gt;&quot;</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:date</span>])
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">get_header</span>(<span class="ruby-string">&quot;Date&quot;</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
      <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;Date&quot;</span>, <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&quot;%a, %d %b %Y %H:%M:%S %z&quot;</span>))
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># Add a mime header if we don't already have one and we have multiple parts</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">multipart?</span>())
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">get_header</span>(<span class="ruby-string">&quot;MIME-Version&quot;</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
      <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;MIME-Version&quot;</span>, <span class="ruby-string">&quot;1.0&quot;</span>)
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">get_header</span>(<span class="ruby-string">&quot;Content-Type&quot;</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
      <span class="ruby-keyword">if</span>(<span class="ruby-ivar">@attachments</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
        <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;Content-Type&quot;</span>, <span class="ruby-node">&quot;multipart/alternative;boundary=\&quot;#{@bodyboundary}\&quot;&quot;</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;Content-Type&quot;</span>, <span class="ruby-node">&quot;multipart/mixed; boundary=\&quot;#{@attachmentboundary}\&quot;&quot;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span>(<span class="ruby-node">&quot;#{headers_to_s()}#{body_to_s()}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- construct-source -->
          
        </div>

        

        
      </div><!-- construct-method -->

    
      <div id="method-i-generate_boundary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">generate_boundary</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>generates a unique boundary string</p>
          

          
          <div class="method-source-code" id="generate_boundary-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 219</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">generate_boundary</span>()
  <span class="ruby-identifier">randomstring</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-value">1</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-value">25</span>) {
    <span class="ruby-identifier">whichglyph</span> = <span class="ruby-identifier">rand</span>(<span class="ruby-value">100</span>)
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">whichglyph</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">40</span>)
      <span class="ruby-identifier">randomstring</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">rand</span>(<span class="ruby-value">25</span>) <span class="ruby-operator">+</span> <span class="ruby-value">65</span>).<span class="ruby-identifier">chr</span>()
    <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">whichglyph</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">70</span>)
      <span class="ruby-identifier">randomstring</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">rand</span>(<span class="ruby-value">25</span>) <span class="ruby-operator">+</span> <span class="ruby-value">97</span>).<span class="ruby-identifier">chr</span>()
    <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">whichglyph</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">90</span>)
      <span class="ruby-identifier">randomstring</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">rand</span>(<span class="ruby-value">10</span>) <span class="ruby-operator">+</span> <span class="ruby-value">48</span>).<span class="ruby-identifier">chr</span>()
    <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">whichglyph</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">95</span>)
      <span class="ruby-identifier">randomstring</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'.'</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">randomstring</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">'_'</span>
    <span class="ruby-keyword">end</span>
  }
  <span class="ruby-keyword">return</span>(<span class="ruby-node">&quot;----=_NextPart_#{randomstring.join()}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- generate_boundary-source -->
          
        </div>

        

        
      </div><!-- generate_boundary-method -->

    
      <div id="method-i-get_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">get_header</span><span
            class="method-args">(header)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns the value (or values) of the named header in an array</p>
          

          
          <div class="method-source-code" id="get_header-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 149</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">get_header</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-identifier">headers</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">headerregex</span> = <span class="ruby-node">%r^#{Regexp.escape(header)}:/</span>
  <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">each</span>() { <span class="ruby-operator">|</span><span class="ruby-identifier">h</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">headerregex</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">h</span>))
      <span class="ruby-identifier">headers</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">h</span>[<span class="ruby-regexp">%r^[^:]+:(.*)/</span>, <span class="ruby-value">1</span>].<span class="ruby-identifier">strip</span>()
    <span class="ruby-keyword">end</span>
  }
  
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">headers</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- get_header-source -->
          
        </div>

        

        
      </div><!-- get_header-method -->

    
      <div id="method-i-html-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">html=</span><span
            class="method-args">(newhtml)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>sets the HTML body of the message. Only the body of the html should be
provided</p>
          

          
          <div class="method-source-code" id="html-3D-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">html=</span>(<span class="ruby-identifier">newhtml</span>)
  <span class="ruby-ivar">@html</span> = <span class="ruby-node">&quot;&lt;html&gt;\n&lt;head&gt;\n&lt;meta content=\&quot;text/html;charset=#{@charset}\&quot; http-equiv=\&quot;Content-Type\&quot;&gt;\n&lt;/head&gt;\n&lt;body bgcolor=\&quot;#ffffff\&quot; text=\&quot;#000000\&quot;&gt;\n#{newhtml}\n&lt;/body&gt;\n&lt;/html&gt;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- html-3D-source -->
          
        </div>

        

        
      </div><!-- html-3D-method -->

    
      <div id="method-i-method_missing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">method_missing</span><span
            class="method-args">(methId, *args)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>implement method missing to provide helper methods for setting and getting
headers. Headers with ‘-’ characters may be set/gotten as ‘x_mailer’ or
‘XMailer’ (splitting will occur between capital letters or on ‘_’
chracters)</p>
          

          
          <div class="method-source-code" id="method_missing-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">method_missing</span>(<span class="ruby-identifier">methId</span>, *<span class="ruby-identifier">args</span>)
  <span class="ruby-identifier">name</span> = <span class="ruby-identifier">methId</span>.<span class="ruby-identifier">id2name</span>()
  
  <span class="ruby-comment"># mangle the name if we have to</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r_/</span>)
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r_/</span>, <span class="ruby-string">'-'</span>)
  <span class="ruby-keyword">elsif</span>(<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r[A-Z]/</span>)
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r([a-zA-Z])([A-Z])/</span>, <span class="ruby-string">'\1-\2'</span>)
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-comment"># determine if it sets or gets, and do the right thing</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">name</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r=$/</span>)
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">1</span>)
      <span class="ruby-keyword">super</span>(<span class="ruby-identifier">methId</span>, <span class="ruby-identifier">args</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">set_header</span>(<span class="ruby-identifier">name</span>[<span class="ruby-regexp">%r^(.*)=$/</span>, <span class="ruby-value">1</span>], <span class="ruby-identifier">args</span>[<span class="ruby-value">0</span>])     
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>)
      <span class="ruby-keyword">super</span>(<span class="ruby-identifier">methId</span>, <span class="ruby-identifier">args</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">headers</span> = <span class="ruby-identifier">get_header</span>(<span class="ruby-identifier">name</span>)
    <span class="ruby-keyword">return</span>(<span class="ruby-identifier">get_header</span>(<span class="ruby-identifier">name</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- method_missing-source -->
          
        </div>

        

        
      </div><!-- method_missing-method -->

    
      <div id="method-i-multipart-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">multipart?</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns true if the email is multipart</p>
          

          
          <div class="method-source-code" id="multipart-3F-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 163</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">multipart?</span>()
  <span class="ruby-keyword">if</span>(<span class="ruby-ivar">@attachments</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-ivar">@html</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword">nil</span>)
    <span class="ruby-keyword">return</span>(<span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">return</span>(<span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- multipart-3F-source -->
          
        </div>

        

        
      </div><!-- multipart-3F-method -->

    
      <div id="method-i-rawhtml-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rawhtml=</span><span
            class="method-args">(newhtml)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>sets the HTML body of the message.  The entire HTML section should be
provided</p>
          

          
          <div class="method-source-code" id="rawhtml-3D-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rawhtml=</span>(<span class="ruby-identifier">newhtml</span>)
  <span class="ruby-ivar">@html</span> = <span class="ruby-identifier">newhtml</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- rawhtml-3D-source -->
          
        </div>

        

        
      </div><!-- rawhtml-3D-method -->

    
      <div id="method-i-remove_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_header</span><span
            class="method-args">(header)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>removes the named header - case insensitive</p>
          

          
          <div class="method-source-code" id="remove_header-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 73</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_header</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">each_index</span>() { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span>(<span class="ruby-ivar">@headers</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">=~</span> <span class="ruby-node">%r^#{Regexp.escape(header)}:/</span>)
      <span class="ruby-ivar">@headers</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">i</span>)
    <span class="ruby-keyword">end</span>
  }
<span class="ruby-keyword">end</span></pre>
          </div><!-- remove_header-source -->
          
        </div>

        

        
      </div><!-- remove_header-method -->

    
      <div id="method-i-replyto" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">replyto</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="replyto-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 95</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">replyto</span>()
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">get_header</span>(<span class="ruby-string">&quot;Reply-To&quot;</span>)[<span class="ruby-value">0</span>])
<span class="ruby-keyword">end</span></pre>
          </div><!-- replyto-source -->
          
        </div>

        

        
      </div><!-- replyto-method -->

    
      <div id="method-i-replyto-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">replyto=</span><span
            class="method-args">(newreplyto)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="replyto-3D-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">replyto=</span>(<span class="ruby-identifier">newreplyto</span>)
  <span class="ruby-identifier">remove_header</span>(<span class="ruby-string">&quot;Reply-To&quot;</span>)
  <span class="ruby-identifier">add_header</span>(<span class="ruby-string">&quot;Reply-To&quot;</span>, <span class="ruby-identifier">newreplyto</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- replyto-3D-source -->
          
        </div>

        

        
      </div><!-- replyto-3D-method -->

    
      <div id="method-i-set_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">set_header</span><span
            class="method-args">(header, value)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>sets a header (removing any other versions of that header)</p>
          

          
          <div class="method-source-code" id="set_header-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 83</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">set_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">value</span>)
  <span class="ruby-identifier">remove_header</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-identifier">add_header</span>(<span class="ruby-identifier">header</span>, <span class="ruby-identifier">value</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- set_header-source -->
          
        </div>

        

        
      </div><!-- set_header-method -->

    
      <div id="method-i-text-3D" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">text=</span><span
            class="method-args">(newtext)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>sets the plain text body of the message</p>
          

          
          <div class="method-source-code" id="text-3D-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">text=</span>(<span class="ruby-identifier">newtext</span>)
  <span class="ruby-ivar">@text</span> = <span class="ruby-identifier">newtext</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- text-3D-source -->
          
        </div>

        

        
      </div><!-- text-3D-method -->

    
      <div id="method-i-to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns a formatted email - equivalent to construct(:messageid =&gt; true)</p>
          

          
          <div class="method-source-code" id="to_s-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 213</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_s</span>()
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">construct</span>(<span class="ruby-value">:messageid</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>))
<span class="ruby-keyword">end</span></pre>
          </div><!-- to_s-source -->
          
        </div>

        

        
      </div><!-- to_s-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-body_to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">body_to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns the body as a properly formatted string</p>
          

          
          <div class="method-source-code" id="body_to_s-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 321</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">body_to_s</span>()
  <span class="ruby-identifier">body</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  
  <span class="ruby-comment"># simple message with one part</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-operator">!</span><span class="ruby-identifier">multipart?</span>())
    <span class="ruby-keyword">return</span>(<span class="ruby-ivar">@text</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;This is a multi-part message in MIME format.\r\n\r\n--#{@attachmentboundary}\r\nContent-Type: multipart/alternative; boundary=\&quot;#{@bodyboundary}\&quot;&quot;</span>
    
    <span class="ruby-keyword">if</span>(<span class="ruby-ivar">@attachments</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
      <span class="ruby-comment"># text part</span>
      <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{buildbodyboundary(&quot;text/plain; charset=#{@charset}; format=flowed&quot;, 'quoted-printable')}\r\n\r\n#{quote_if_necessary(@text, @charset)}&quot;</span>
      
      <span class="ruby-comment"># html part if one is provided</span>
      <span class="ruby-keyword">if</span> <span class="ruby-ivar">@html</span>
        <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{buildbodyboundary(&quot;text/html; charset=#{@charset}&quot;, 'quoted-printable')}\r\n\r\n#{quote_if_necessary(@html, @charset)}&quot;</span>
      <span class="ruby-keyword">end</span>
      
      <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;--#{@bodyboundary}--&quot;</span>
      
      <span class="ruby-comment"># and, the attachments</span>
      <span class="ruby-keyword">if</span>(<span class="ruby-ivar">@attachments</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>)
        <span class="ruby-ivar">@attachments</span>.<span class="ruby-identifier">each</span>() { <span class="ruby-operator">|</span><span class="ruby-identifier">attachment</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{buildattachmentboundary(attachment)}\r\n\r\n#{attachment['attachment']}&quot;</span>
        }
        <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\r\n--#{@attachmentboundary}--&quot;</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-comment"># text part</span>
      <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{buildbodyboundary(&quot;text/plain; charset=#{@charset}; format=flowed&quot;, 'quoted-printable')}\r\n\r\n#{quote_if_necessary(@text, @charset)}&quot;</span>
      
      <span class="ruby-comment"># html part</span>
      <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{buildbodyboundary(&quot;text/html; charset=#{@charset}&quot;, 'quoted-printable')}\r\n\r\n#{quote_if_necessary(@html, @charset)}&quot;</span>
      
      <span class="ruby-identifier">body</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;--#{@bodyboundary}--&quot;</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-keyword">return</span>(<span class="ruby-identifier">body</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\r\n\r\n&quot;</span>))
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- body_to_s-source -->
          
        </div>

        

        
      </div><!-- body_to_s-method -->

    
      <div id="method-i-buildattachmentboundary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">buildattachmentboundary</span><span
            class="method-args">(attachment)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>builds a boundary string for including attachments in the body, expects an
attachment hash as built by <a
href="MailFactory.html#method-i-add_attachment">#add_attachment</a> and <a
href="MailFactory.html#method-i-add_attachment_as">#add_attachment_as</a></p>
          

          
          <div class="method-source-code" id="buildattachmentboundary-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 365</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">buildattachmentboundary</span>(<span class="ruby-identifier">attachment</span>)
  <span class="ruby-identifier">disposition</span> = <span class="ruby-node">&quot;Content-Disposition: inline; filename=\&quot;#{attachment['filename']}\&quot;&quot;</span>
  <span class="ruby-identifier">boundary</span> = <span class="ruby-node">&quot;--#{@attachmentboundary}\r\nContent-Type: #{attachment['mimetype']}; name=\&quot;#{attachment['filename']}\&quot;\r\nContent-Transfer-Encoding: base64\r\n#{disposition}&quot;</span>
  <span class="ruby-keyword">if</span>(<span class="ruby-identifier">attachment</span>[<span class="ruby-string">'headers'</span>])
    <span class="ruby-identifier">boundary</span> = <span class="ruby-identifier">boundary</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;\r\n#{attachment['headers'].join(&quot;\r\n&quot;)}&quot;</span>
  <span class="ruby-keyword">end</span>
  
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">boundary</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- buildattachmentboundary-source -->
          
        </div>

        

        
      </div><!-- buildattachmentboundary-method -->

    
      <div id="method-i-buildbodyboundary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">buildbodyboundary</span><span
            class="method-args">(type, encoding)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>builds a boundary string for inclusion in the body of a message</p>
          

          
          <div class="method-source-code" id="buildbodyboundary-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 377</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">buildbodyboundary</span>(<span class="ruby-identifier">type</span>, <span class="ruby-identifier">encoding</span>)
  <span class="ruby-keyword">return</span>(<span class="ruby-node">&quot;--#{@bodyboundary}\r\nContent-Type: #{type}\r\nContent-Transfer-Encoding: #{encoding}&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- buildbodyboundary-source -->
          
        </div>

        

        
      </div><!-- buildbodyboundary-method -->

    
      <div id="method-i-file_encode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_encode</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns a base64 encoded version of the contents of str</p>
          

          
          <div class="method-source-code" id="file_encode-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 383</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_encode</span>(<span class="ruby-identifier">str</span>)
  <span class="ruby-identifier">collection</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>()
  <span class="ruby-identifier">enc</span> = [<span class="ruby-identifier">str</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">'m'</span>)
  <span class="ruby-comment">#  while(enc.length &gt; 60)</span>
  <span class="ruby-comment">#    collection &lt;&lt; enc.slice!(0..59)</span>
  <span class="ruby-comment">#  end</span>
  <span class="ruby-comment">#  collection &lt;&lt; enc</span>
  <span class="ruby-comment">#  return(collection.join(&quot;\n&quot;))</span>
  <span class="ruby-keyword">return</span>(<span class="ruby-identifier">enc</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- file_encode-source -->
          
        </div>

        

        
      </div><!-- file_encode-method -->

    
      <div id="method-i-headers_to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">headers_to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>returns the @headers as a properly formatted string</p>
          

          
          <div class="method-source-code" id="headers_to_s-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 315</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">headers_to_s</span>()
  <span class="ruby-keyword">return</span>(<span class="ruby-node">&quot;#{@headers.join(&quot;\r\n&quot;)}\r\n\r\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- headers_to_s-source -->
          
        </div>

        

        
      </div><!-- headers_to_s-method -->

    
      <div id="method-i-quote_address_if_necessary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quote_address_if_necessary</span><span
            class="method-args">(address, charset)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Quote the given address if it needs to be. The address may be a regular
email address, or it can be a phrase followed by an address in brackets.
The phrase is the only part that will be quoted, and only if it needs to
be. This allows extended characters to be used in the “to”, “from”, “cc”,
and “bcc” headers.</p>
          

          
          <div class="method-source-code" id="quote_address_if_necessary-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 453</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quote_address_if_necessary</span>(<span class="ruby-identifier">address</span>, <span class="ruby-identifier">charset</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Array</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">address</span>
    <span class="ruby-identifier">address</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span> <span class="ruby-identifier">quote_address_if_necessary</span>(<span class="ruby-identifier">a</span>, <span class="ruby-identifier">charset</span>) }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">address</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r^(\S.*)\s+(&lt;.*&gt;)$/</span>
    <span class="ruby-identifier">address</span> = <span class="ruby-node">$2</span>
    <span class="ruby-identifier">phrase</span> = <span class="ruby-identifier">quote_if_necessary</span>(<span class="ruby-node">$1</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r^['&quot;](.*)['&quot;]$/</span>, <span class="ruby-string">'\1'</span>), <span class="ruby-identifier">charset</span>, <span class="ruby-keyword">true</span>)
    <span class="ruby-node">&quot;\&quot;#{phrase}\&quot; #{address}&quot;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">address</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- quote_address_if_necessary-source -->
          
        </div>

        

        
      </div><!-- quote_address_if_necessary-method -->

    
      <div id="method-i-quote_if_necessary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quote_if_necessary</span><span
            class="method-args">(text, charset, instruction = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Quote the given text if it contains any “illegal” characters</p>
          

          
          <div class="method-source-code" id="quote_if_necessary-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quote_if_necessary</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span>, <span class="ruby-identifier">instruction</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">text</span>
  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span><span class="ruby-operator">::</span><span class="ruby-constant">ASCII_8BIT</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:force_encoding</span>)
  <span class="ruby-comment">#(text =~ CHARS_NEEDING_QUOTING) ? (instruction ? quoted_printable_with_instruction(text, charset) : quoted_printable_encode(text)) : text</span>
  <span class="ruby-identifier">instruction</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">quoted_printable_with_instruction</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">quoted_printable_encode</span>(<span class="ruby-identifier">text</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- quote_if_necessary-source -->
          
        </div>

        

        
      </div><!-- quote_if_necessary-method -->

    
      <div id="method-i-quoted_printable_encode" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quoted_printable_encode</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>rfc2045 compatible. use rfc2047 for headers (such as the Subject line)
instead</p>
          

          
          <div class="method-source-code" id="quoted_printable_encode-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 404</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quoted_printable_encode</span>(<span class="ruby-identifier">text</span>)
  [<span class="ruby-identifier">text</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-string">'M'</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r\n/</span>, <span class="ruby-string">&quot;\r\n&quot;</span>).<span class="ruby-identifier">chomp</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r=$/</span>, <span class="ruby-string">''</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- quoted_printable_encode-source -->
          
        </div>

        

        
      </div><!-- quoted_printable_encode-method -->

    
      <div id="method-i-quoted_printable_encode_header" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quoted_printable_encode_header</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="quoted_printable_encode_header-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 413</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quoted_printable_encode_header</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-identifier">text</span>.<span class="ruby-identifier">enum_for</span>(<span class="ruby-value">:each_byte</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ord</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">ord</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">128</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">ord</span> <span class="ruby-operator">!=</span> <span class="ruby-value">61</span> <span class="ruby-comment"># 61 is ascii '='</span>
      <span class="ruby-identifier">ord</span>.<span class="ruby-identifier">chr</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-string">'=%X'</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">ord</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">''</span>).
      <span class="ruby-identifier">chomp</span>.
      <span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r=$/</span>,<span class="ruby-string">''</span>).
      <span class="ruby-identifier">gsub</span>(<span class="ruby-string">'?'</span>, <span class="ruby-string">'=3F'</span>).
      <span class="ruby-identifier">gsub</span>(<span class="ruby-string">'_'</span>, <span class="ruby-string">'=5F'</span>).
      <span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">%r /</span>, <span class="ruby-string">'_'</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- quoted_printable_encode_header-source -->
          
        </div>

        

        
      </div><!-- quoted_printable_encode_header-method -->

    
      <div id="method-i-quoted_printable_with_instruction" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quoted_printable_with_instruction</span><span
            class="method-args">(text, charset)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Convert the given text into quoted printable format, with an instruction
that the text be eventually interpreted in the given charset.</p>
          

          
          <div class="method-source-code" id="quoted_printable_with_instruction-source">
            <pre><span class="ruby-comment"># File lib/mailfactory.rb, line 398</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quoted_printable_with_instruction</span>(<span class="ruby-identifier">text</span>, <span class="ruby-identifier">charset</span>)
  <span class="ruby-identifier">text</span> = <span class="ruby-identifier">quoted_printable_encode_header</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-node">&quot;=?#{charset}?Q?#{text}?=&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- quoted_printable_with_instruction-source -->
          
        </div>

        

        
      </div><!-- quoted_printable_with_instruction-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

